---
- hosts: localhost
  connection: local
  become: true

  tasks:
  - name: Create the `aur_builder` user
    become: yes
    ansible.builtin.user:
      name: aur_builder
      create_home: yes
      group: wheel

  - name: Allow the `aur_builder` user to run `sudo pacman` without a password
    become: yes
    ansible.builtin.lineinfile:
      path: /etc/sudoers.d/11-install-aur_builder
      line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
      create: yes
      validate: 'visudo -cf %s'

  # Note: Dependency resolution will still include repository packages.
  - name: Upgrade the system using yay.
    kewlfft.aur.aur:
      upgrade: yes
      use: yay
      aur_only: no
    become: yes
    become_user: aur_builder

- name: Install packages using yay
  kewlfft.aur.aur:
    use: yay
    name:
      # fonts
      - adobe-source-code-pro-fonts
      # icons
      - adwaita-icon-theme
      - hicolor-icon-theme
      # terminal emulator
      - alacritty
      # audio
      - alsa-utils
      # devops
      - ansible
      - flux-bin

      - barrier
      - btrfs-progs
      - containerd
      - cups
      - curl
      - discord
      - direnv
      - dmenu2
      - docker
      - docker-compose
      - docker-credential-pass-bin
      - dosfstools
      - dunst
      - etcher-bin
      - ffmpeg
      - gnome-keyring
      - helm
      - hdparm
      - htop
      - hplib
      - iftop
    become: yes
    become_user: aur_builder


  # - name: install packages
  #   package:
  #     name:
  #       - htop
  #       - tmux
  #       - vim-nox

  # - name: copy wallpaper file
  #   copy:
  #     src: files/wallpaper.png
  #     dest: /usr/share/backgrounds/ansible-wallpaper.png
  #     owner: root
  #     group: root

  # - name: set wallpaper
  #   become_user: jay
  #   dconf:
  #     key: "/org/gnome/desktop/background/picture-uri"
  #     value: "'file:///usr/share/backgrounds/ansible-wallpaper.png'"

  # - name: set wallpaper position
  #   become_user: jay
  #   dconf:
  #     key: "/org/gnome/desktop/background/picture-options"
  #     value: "'zoom'"

  # - name: copy .bashrc file
  #   copy:
  #    src: files/bashrc
  #    dest: /home/jay/.bashrc
  #    owner: jay
  #    group: jay

  # - name: add ansible user
  #   user:
  #     name: velociraptor
  #     system: yes

  # - name: set up sudo for ansible user
  #   copy:
  #     src: files/sudoer_velociraptor
  #     dest: /etc/sudoers.d/velociraptor
  #     owner: root
  #     group: root
  #     mode: 0440

  # - name: add ansible-pull cron job
  #   cron:
  #     name: ansible auto-provision
  #     user: velociraptor
  #     minute: "*/10"
  #     job: ansible-pull -o -U https://github.com/jlacroix82/ansible_pull_tutorial.git
